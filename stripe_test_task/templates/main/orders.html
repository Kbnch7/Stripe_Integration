{% extends 'base.html' %}

{% block title %}Мои заказы | Магазин{% endblock %}

{% block content %}
<div class="container py-5">
    <h1 class="display-5 fw-bold text-primary text-center mb-5">Мои заказы</h1>

    {% if orders %}
        <div class="row row-cols-1 row-cols-md-2 g-4">
            {% for order in orders %}
                <div class="col">
                    <div class="card shadow-sm border-0 h-100">
                        <div class="card-header bg-primary text-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Заказ №{{ order.id }}</h5>
                                <small>{{ order.paid_at|date:"d.m.Y H:i" }}</small>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <strong>Статус:</strong>
                                <span class="badge bg-success">Оплачен</span>
                            </div>

                            <div class="mb-3">
                                <strong>Товары ({{ order.items.count }}):</strong>
                                <ul class="list-unstyled mt-2">
                                    {% for order_item in order.items.all %}
                                        <li class="mb-2">
                                            <div class="d-flex justify-content-between">
                                                <span>{{ order_item.amount }} × {{ order_item.item.name }}</span>
                                                <span class="text-muted">{{ order_item.price|floatformat:2 }} USD</span>
                                            </div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>

                            <div class="d-flex justify-content-between align-items-center pt-3 border-top">
                                <strong>Итого:</strong>
                                <h4 class="text-success mb-0">{{ order.total_price|floatformat:2 }} USD</h4>
                            </div>
                        </div>

                        <div class="card-footer bg-light text-muted small">
                            ID платежа: <code>{{ order.stripe_session_id|truncatechars:30 }}</code>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-1">
            <h3 class="text-muted mb-3">У вас пока нет заказов</h3>
            <p class="text-muted mb-4">Когда вы что-нибудь купите — заказы появятся здесь</p>
            <a href="{% url 'home' %}" class="btn btn-primary btn-lg px-5">
                Перейти к покупкам
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}